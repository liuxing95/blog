---
title: 'OpenAI Codex'
date: '2025-11-12'
excerpt: 'OpenAI Codex å®Œæ•´æ¶æ„åˆ†æä¸å®ç°æŒ‡å—'
tags: ['Github', 'codex']
series: 'Github'
---

# OpenAI Codex å®Œæ•´æ¶æ„åˆ†æä¸å®ç°æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„è®¾è®¡](#æ ¸å¿ƒæ¶æ„è®¾è®¡)
3. [æŠ€æœ¯æ ˆä¸å®ç°](#æŠ€æœ¯æ ˆä¸å®ç°)
4. [Agent è®¾è®¡æ¨¡å¼](#agent-è®¾è®¡æ¨¡å¼)
5. [å·¥å…·ç³»ç»Ÿ](#å·¥å…·ç³»ç»Ÿ)
6. [å®‰å…¨æ²™ç®±æœºåˆ¶](#å®‰å…¨æ²™ç®±æœºåˆ¶)
7. [æ‰§è¡Œæµç¨‹è¯¦è§£](#æ‰§è¡Œæµç¨‹è¯¦è§£)
8. [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
9. [MCP é›†æˆ](#mcp-é›†æˆ)
10. [å¦‚ä½•å®ç°ç±»ä¼¼çš„ Agent](#å¦‚ä½•å®ç°ç±»ä¼¼çš„-agent)
11. [æ¶æ„å›¾](#æ¶æ„å›¾)

---

## é¡¹ç›®æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ Codex CLI?

OpenAI Codex CLI æ˜¯ä¸€ä¸ªå¼€æºçš„ç»ˆç«¯ç¼–ç ä»£ç†,å®ƒèƒ½åœ¨æœ¬åœ°è¿è¡Œ,è¯»å–ã€ä¿®æ”¹å’Œæ‰§è¡Œä»£ç ã€‚å®ƒæ˜¯ OpenAI ä¸ºå¼€å‘è€…æä¾›çš„ AI ç¼–ç¨‹åŠ©æ‰‹,å¯ä»¥:

- âœ… è‡ªåŠ¨ç¼–å†™å’Œé‡æ„ä»£ç 
- âœ… æ‰§è¡Œ shell å‘½ä»¤
- âœ… è¿è¡Œæµ‹è¯•å’Œè°ƒè¯•
- âœ… ç”Ÿæˆ Pull Request
- âœ… ä»£ç å®¡æŸ¥å’Œåˆ†æ
- âœ… æ”¯æŒå¤šæ¨¡æ€è¾“å…¥(æ–‡æœ¬+å›¾åƒ)

### æ ¸å¿ƒç‰¹ç‚¹

1. **å¼€æº** - Apache 2.0 è®¸å¯è¯
2. **æœ¬åœ°è¿è¡Œ** - ä»£ç ä¸ä¸Šä¼ äº‘ç«¯
3. **ç”¨ Rust é‡å†™** - ä» TypeScript/Node.js è¿ç§»åˆ° Rust,è·å¾—æ›´é«˜æ€§èƒ½å’Œå®‰å…¨æ€§
4. **æ²™ç®±éš”ç¦»** - å¤šå±‚å®‰å…¨æœºåˆ¶ä¿æŠ¤ç³»ç»Ÿ
5. **MCP æ”¯æŒ** - å¯ä½œä¸º MCP å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨

---

## æ ¸å¿ƒæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

Codex CLI é‡‡ç”¨**åˆ†å±‚æ¶æ„**,å°†ç”¨æˆ·ç•Œé¢ã€æ ¸å¿ƒå¼•æ“å’Œå·¥å…·æ‰§è¡Œåˆ†ç¦»:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   TUI    â”‚  â”‚   Exec   â”‚  â”‚   MCP Server    â”‚        â”‚
â”‚  â”‚ (ç»ˆç«¯UI)  â”‚  â”‚ (æ— å¤´æ¨¡å¼) â”‚  â”‚  (åè®®æœåŠ¡å™¨)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æäº¤/äº‹ä»¶åè®®å±‚                           â”‚
â”‚           Submission Queue / Event Queue                â”‚
â”‚         (å¼‚æ­¥åŒå‘é€šä¿¡,è§£è€¦è¯·æ±‚å’Œå¤„ç†)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒå¼•æ“å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚          codex-core (Rust Workspace)         â”‚       â”‚
â”‚  â”‚                                              â”‚       â”‚
â”‚  â”‚  â€¢ Session ç®¡ç†(ä¼šè¯çŠ¶æ€)                      â”‚       â”‚
â”‚  â”‚  â€¢ TurnContext(å•è½®ä¸Šä¸‹æ–‡)                     â”‚       â”‚
â”‚  â”‚  â€¢ Agent Loop(ä¸»å¾ªç¯é€»è¾‘)                      â”‚       â”‚
â”‚  â”‚  â€¢ Model Integration(æ¨¡å‹äº¤äº’)                 â”‚       â”‚
â”‚  â”‚  â€¢ Tool Execution(å·¥å…·æ‰§è¡Œ)                    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å·¥å…·ä¸æœåŠ¡å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Sandbox   â”‚  â”‚   MCP    â”‚  â”‚  File Ops    â”‚        â”‚
â”‚  â”‚  (æ²™ç®±)     â”‚  â”‚ (åè®®)    â”‚  â”‚  (æ–‡ä»¶æ“ä½œ)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Auth     â”‚  â”‚  Config  â”‚  â”‚  Responses   â”‚        â”‚
â”‚  â”‚  (è®¤è¯)     â”‚  â”‚  (é…ç½®)   â”‚  â”‚  API         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rust Workspace ç»“æ„

Codex CLI ä½¿ç”¨ Cargo Workspace ç»„ç»‡å¤šä¸ª crate:

```
codex-rs/
â”œâ”€â”€ cli/                 # CLI å…¥å£å’Œå‘½ä»¤åˆ†å‘
â”œâ”€â”€ core/                # æ ¸å¿ƒå¼•æ“(Session, Agent Loop)
â”œâ”€â”€ tui/                 # ç»ˆç«¯ UI (ä½¿ç”¨ Ratatui)
â”œâ”€â”€ exec/                # æ— å¤´æ‰§è¡Œæ¨¡å¼
â”œâ”€â”€ mcp-server/          # MCP æœåŠ¡å™¨å®ç°
â”œâ”€â”€ protocol/            # é€šä¿¡åè®®å®šä¹‰
â”œâ”€â”€ login/               # è®¤è¯ç³»ç»Ÿ
â”œâ”€â”€ sandbox/             # æ²™ç®±æŠ½è±¡å±‚
â”œâ”€â”€ macos-seatbelt/      # macOS æ²™ç®±å®ç°
â”œâ”€â”€ linux-sandbox/       # Linux Landlock + seccomp
â”œâ”€â”€ responses-api-proxy/ # API ä»£ç†æœåŠ¡å™¨
â”œâ”€â”€ process-hardening/   # è¿›ç¨‹åŠ å›º
â””â”€â”€ config/              # é…ç½®ç®¡ç†
```

---

## æŠ€æœ¯æ ˆä¸å®ç°

### ä¸ºä»€ä¹ˆä» TypeScript è¿ç§»åˆ° Rust?

OpenAI å›¢é˜Ÿåˆ—å‡ºäº†ä»¥ä¸‹åŸå› :

1. **é›¶ä¾èµ–å®‰è£…** - ä¸å†éœ€è¦ Node.js v22+
2. **åŸç”Ÿå®‰å…¨ç»‘å®š** - Rust å¯ç›´æ¥ä½¿ç”¨ OS çº§æ²™ç®± API
3. **ä¼˜åŒ–æ€§èƒ½** - æ—  GC,å†…å­˜å ç”¨æ›´ä½
4. **å¯æ‰©å±•åè®®** - æ”¯æŒå…¶ä»–è¯­è¨€æ‰©å±•(TypeScript, Python)

### æ ¸å¿ƒæŠ€æœ¯

| ç»„ä»¶            | æŠ€æœ¯é€‰å‹                      |
| --------------- | ----------------------------- |
| **CLI æ¡†æ¶**    | `clap` (å‘½ä»¤è¡Œè§£æ)           |
| **å¼‚æ­¥è¿è¡Œæ—¶**  | `tokio` (å¼‚æ­¥ I/O)            |
| **ç»ˆç«¯ UI**     | `ratatui` (åŸ tui-rs)         |
| **HTTP å®¢æˆ·ç«¯** | `reqwest`                     |
| **åºåˆ—åŒ–**      | `serde` + `serde_json`        |
| **é…ç½®ç®¡ç†**    | `toml`                        |
| **macOS æ²™ç®±**  | Apple Seatbelt (sandbox-exec) |
| **Linux æ²™ç®±**  | Landlock + seccomp            |
| **MCP å®ç°**    | è‡ªå®šä¹‰ stdio åè®®             |

---

## Agent è®¾è®¡æ¨¡å¼

### æ ¸å¿ƒç†å¿µ:å•å¾ªç¯ ReAct æ¨¡å¼

Codex é‡‡ç”¨**å•çº¿ç¨‹ Agent Loop**,é¿å…å¤š Agent å¹¶å‘çš„å¤æ‚æ€§:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Agent Loop (å•å¾ªç¯)                       â”‚
â”‚                                                           â”‚
â”‚  1. æ¥æ”¶ç”¨æˆ·è¾“å…¥                                           â”‚
â”‚  2. æ„å»ºä¸Šä¸‹æ–‡(System Prompt + å†å² + ç”¨æˆ·æ¶ˆæ¯)              â”‚
â”‚  3. è°ƒç”¨ Responses API (æµå¼å“åº”)                          â”‚
â”‚  4. å¤„ç†æ¨¡å‹è¾“å‡º:                                          â”‚
â”‚     â”œâ”€ reasoning (æ¨ç†è¿‡ç¨‹)                                â”‚
â”‚     â”œâ”€ message (æ–‡æœ¬æ¶ˆæ¯)                                  â”‚
â”‚     â””â”€ function_call (å·¥å…·è°ƒç”¨)                            â”‚
â”‚  5. æ‰§è¡Œå·¥å…· â†’ è·å–ç»“æœ â†’ è¿½åŠ åˆ°å†å²                         â”‚
â”‚  6. å›åˆ°æ­¥éª¤ 2,ç»§ç»­å¾ªç¯                                     â”‚
â”‚  7. ç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–ç”¨æˆ·ä¸­æ–­                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### System Prompt è®¾è®¡

Codex çš„ System Prompt éå¸¸å…³é”®,å®ƒå®šä¹‰äº† Agent çš„"æ“ä½œç³»ç»Ÿ":

```markdown
You are Codex, based on GPT-5. You are running as a coding agent
in the Codex CLI on a user's computer.

## General

- The arguments to `shell` will be passed to execvp()
- Most terminal commands should be prefixed with ["bash", "-lc"]
- Always set the `workdir` param when using the shell function
- When searching, prefer `rg` over `grep` (faster)

## Tools

1. **shell** - Execute shell commands
2. **apply_patch** - Apply unified diffs to files

## Coding Guidelines

- Minimal, surgical diffs (avoid full file rewrites)
- Run tests to verify changes
- Use project's existing patterns
- Check linter/formatter output

## Workflow

1. Read files to understand context (cat, rg, find)
2. Make minimal changes (apply_patch)
3. Verify changes (run tests, linters)
4. Iterate until success
```

**å…³é”®ç‚¹**:

- âœ… ç®€æ´æ˜äº† - GPT-5-Codex æç¤ºè¯æ¯” GPT-5 å°‘ 60% token
- âœ… å·¥å…·ä¼˜å…ˆ - æ•™ä¼šæ¨¡å‹"shell-first"æ€ç»´
- âœ… å®‰å…¨é»˜è®¤ - æ˜ç¡®æ²™ç®±å’Œç½‘ç»œé™åˆ¶
- âœ… éªŒè¯é©±åŠ¨ - å¼ºè°ƒæµ‹è¯•å’ŒéªŒè¯

---

## å·¥å…·ç³»ç»Ÿ

### ä¸»è¦å·¥å…·

Codex æš´éœ²ç»™æ¨¡å‹çš„å·¥å…·éå¸¸ç®€æ´:

#### 1. `shell` å·¥å…·

```rust
// å·¥å…·å®šä¹‰
{
  "name": "shell",
  "description": "Execute shell command in sandbox",
  "parameters": {
    "cmd": ["string"],      // å‘½ä»¤æ•°ç»„
    "workdir": "string",    // å·¥ä½œç›®å½•
    "env": {"key": "value"} // ç¯å¢ƒå˜é‡(å¯é€‰)
  }
}
```

**æ‰§è¡Œæµç¨‹**:

1. æ¨¡å‹ç”Ÿæˆ function_call: `{"name": "shell", "arguments": {"cmd": ["ls", "-la"]}}`
2. CLI æ‹¦æˆªè°ƒç”¨ â†’ æ£€æŸ¥å®¡æ‰¹ç­–ç•¥
3. æ ¹æ®ç­–ç•¥å†³å®šæ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤
4. åœ¨æ²™ç®±ä¸­æ‰§è¡Œå‘½ä»¤
5. è¿”å› stdout/stderr ç»™æ¨¡å‹

#### 2. `apply_patch` å·¥å…·

```rust
// ç‰¹æ®Šæ ¼å¼çš„è¡¥ä¸
*** Begin Patch
*** Update File: src/main.rs
@@
-fn main() {
-    println!("Hello");
+fn main() {
+    println!("Hello, World!");
}
*** End Patch
```

**å¤„ç†é€»è¾‘**:

1. è§£æè¡¥ä¸æ ¼å¼
2. ç”Ÿæˆå½©è‰² diff å±•ç¤ºç»™ç”¨æˆ·
3. æ ¹æ®å®¡æ‰¹ç­–ç•¥å†³å®šæ˜¯å¦åº”ç”¨
4. ä½¿ç”¨ `fs` æ“ä½œç›´æ¥ä¿®æ”¹æ–‡ä»¶

### å®¡æ‰¹ç­–ç•¥

Codex æä¾› 3 ç§å®¡æ‰¹æ¨¡å¼:

| æ¨¡å¼                     | è¯»æ–‡ä»¶  | å†™æ–‡ä»¶    | æ‰§è¡Œå‘½ä»¤  | ç”¨ä¾‹            |
| ------------------------ | ------- | --------- | --------- | --------------- |
| **Suggest** (å»ºè®®æ¨¡å¼)   | âœ… è‡ªåŠ¨ | âŒ éœ€ç¡®è®¤ | âŒ éœ€ç¡®è®¤ | æœ€å®‰å…¨,é€‚åˆå­¦ä¹  |
| **Auto-Edit** (è‡ªåŠ¨ç¼–è¾‘) | âœ… è‡ªåŠ¨ | âœ… è‡ªåŠ¨   | âŒ éœ€ç¡®è®¤ | å¿«é€Ÿé‡æ„        |
| **Full-Auto** (å…¨è‡ªåŠ¨)   | âœ… è‡ªåŠ¨ | âœ… è‡ªåŠ¨   | âœ… è‡ªåŠ¨   | CI/CD ç®¡é“      |

### å·¥å…·åˆ†ç±»é€»è¾‘

```rust
fn can_auto_approve(cmd: &[String], policy: ApprovalMode) -> bool {
    match policy {
        ApprovalMode::Suggest => {
            // åªå…è®¸è¯»æ“ä½œ
            is_read_only_command(cmd)
        }
        ApprovalMode::AutoEdit => {
            // å…è®¸è¯»æ“ä½œ + æ–‡ä»¶å†™å…¥
            is_read_only_command(cmd) || is_file_write(cmd)
        }
        ApprovalMode::FullAuto => {
            // å…è®¸æ‰€æœ‰æ“ä½œ(åœ¨æ²™ç®±å†…)
            true
        }
    }
}

fn is_read_only_command(cmd: &[String]) -> bool {
    matches!(cmd[0].as_str(), "cat" | "ls" | "head" | "tail" | "rg" | "find")
}
```

---

## å®‰å…¨æ²™ç®±æœºåˆ¶

### å¤šå±‚é˜²æŠ¤

Codex å®ç°äº†çºµæ·±é˜²å¾¡:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: å®¡æ‰¹ç­–ç•¥ (Application-Level Controls)    â”‚
â”‚  â€¢ å‘½ä»¤åˆ†ç±»(è¯»/å†™/æ‰§è¡Œ)                            â”‚
â”‚  â€¢ ç”¨æˆ·ç¡®è®¤æµç¨‹                                   â”‚
â”‚  â€¢ å‘½ä»¤é»‘åå•                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: OS çº§æ²™ç®± (OS-Level Sandboxing)         â”‚
â”‚  macOS:    Apple Seatbelt (sandbox-exec)        â”‚
â”‚  Linux:    Landlock + seccomp-bpf               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: ç½‘ç»œéš”ç¦» (Network Isolation)             â”‚
â”‚  â€¢ é»˜è®¤ç¦ç”¨ç½‘ç»œ                                   â”‚
â”‚  â€¢ ç™½åå•:ä»…å…è®¸ OpenAI API                       â”‚
â”‚  â€¢ iptables/ipset é˜²ç«å¢™è§„åˆ™                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: æ–‡ä»¶ç³»ç»Ÿé™åˆ¶ (Filesystem Restrictions)   â”‚
â”‚  â€¢ åªè¯»:ç³»ç»Ÿç›®å½•                                  â”‚
â”‚  â€¢ è¯»å†™:$PWD (é¡¹ç›®ç›®å½•)                           â”‚
â”‚  â€¢ è¯»å†™:$TMPDIR (ä¸´æ—¶ç›®å½•)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### macOS å®ç°

```rust
// ä½¿ç”¨ Apple Seatbelt
fn create_sandbox_profile() -> String {
    r#"
    (version 1)
    (deny default)
    (allow file-read*)
    (allow file-write*
        (subpath (param "PWD"))
        (subpath (param "TMPDIR")))
    (deny network*)
    (allow network-outbound
        (remote ip "api.openai.com:443"))
    "#
}

fn run_in_sandbox(cmd: &[String]) -> Result<Output> {
    Command::new("sandbox-exec")
        .arg("-p")
        .arg(create_sandbox_profile())
        .args(cmd)
        .output()
}
```

### Linux å®ç°

```rust
// ä½¿ç”¨ Landlock (Linux 5.13+)
use landlock::*;

fn create_landlock_ruleset() -> Result<Ruleset> {
    Ruleset::default()
        .handle_access(AccessFs::from_all(ABI::V2))?
        .add_rule(PathBeneath::new(&pwd, AccessFs::from_all(ABI::V2)))?
        .add_rule(PathBeneath::new("/tmp", AccessFs::from_all(ABI::V2)))?
        .restrict_self()?
}

// seccomp-bpf é™åˆ¶ç³»ç»Ÿè°ƒç”¨
fn apply_seccomp_filter() {
    let filter = SeccompFilter::new()
        .allow_syscall("read")
        .allow_syscall("write")
        // ... ç™½åå•å…¶ä»–å¿…è¦ç³»ç»Ÿè°ƒç”¨
        .deny_default();
    filter.load().unwrap();
}
```

---

## æ‰§è¡Œæµç¨‹è¯¦è§£

### å®Œæ•´çš„ç”¨æˆ·è¯·æ±‚æµç¨‹

è®©æˆ‘ä»¬è·Ÿè¸ªä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚:`codex "Add error handling to main.rs"`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: CLI å…¥å£                                         â”‚
â”‚  â€¢ è§£æå‘½ä»¤è¡Œå‚æ•°                                         â”‚
â”‚  â€¢ åŠ è½½é…ç½®æ–‡ä»¶ (~/.codex/config.toml)                   â”‚
â”‚  â€¢ æ£€æŸ¥è®¤è¯çŠ¶æ€                                          â”‚
â”‚  â€¢ åˆå§‹åŒ– TUI æˆ– Exec æ¨¡å¼                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ä¸Šä¸‹æ–‡æ„å»º                                        â”‚
â”‚  â€¢ è¯»å–é¡¹ç›®æ–‡æ¡£ (AGENTS.md, codex.md)                    â”‚
â”‚  â€¢ è¯»å–å…¨å±€æŒ‡ä»¤ (~/.codex/instructions.md)               â”‚
â”‚  â€¢ æ£€æŸ¥ Git çŠ¶æ€                                         â”‚
â”‚  â€¢ ç»„è£… System Prompt                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æäº¤åˆ°æ ¸å¿ƒå¼•æ“                                    â”‚
â”‚  â€¢ åˆ›å»º Submission: Op::StartTurn { prompt, ... }       â”‚
â”‚  â€¢ å‘é€åˆ° Submission Queue                               â”‚
â”‚  â€¢ æ ¸å¿ƒå¼•æ“æ¥æ”¶å¹¶å¤„ç†                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Agent Loop æ‰§è¡Œ                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.1 è°ƒç”¨ Responses API                       â”‚        â”‚
â”‚  â”‚  POST /v1/responses                         â”‚        â”‚
â”‚  â”‚  {                                          â”‚        â”‚
â”‚  â”‚    "model": "gpt-5-codex",                  â”‚        â”‚
â”‚  â”‚    "messages": [...],                       â”‚        â”‚
â”‚  â”‚    "tools": [{"name": "shell"}, ...],       â”‚        â”‚
â”‚  â”‚    "stream": true                           â”‚        â”‚
â”‚  â”‚  }                                          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.2 å¤„ç†æµå¼å“åº”                              â”‚        â”‚
â”‚  â”‚  â€¢ response.reasoning (å†…éƒ¨æ¨ç†)             â”‚        â”‚
â”‚  â”‚  â€¢ response.message (æ–‡æœ¬è¾“å‡º)               â”‚        â”‚
â”‚  â”‚  â€¢ response.function_call (å·¥å…·è°ƒç”¨)         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.3 æ‰§è¡Œå·¥å…·è°ƒç”¨                              â”‚        â”‚
â”‚  â”‚  å‡è®¾æ¨¡å‹è¾“å‡º:                                â”‚        â”‚
â”‚  â”‚  {                                          â”‚        â”‚
â”‚  â”‚    "name": "shell",                         â”‚        â”‚
â”‚  â”‚    "arguments": {                           â”‚        â”‚
â”‚  â”‚      "cmd": ["cat", "src/main.rs"]          â”‚        â”‚
â”‚  â”‚    }                                        â”‚        â”‚
â”‚  â”‚  }                                          â”‚        â”‚
â”‚  â”‚                                             â”‚        â”‚
â”‚  â”‚  â†’ æ£€æŸ¥å®¡æ‰¹ç­–ç•¥                              â”‚        â”‚
â”‚  â”‚  â†’ åœ¨æ²™ç®±ä¸­æ‰§è¡Œ cat src/main.rs              â”‚        â”‚
â”‚  â”‚  â†’ è¿”å›æ–‡ä»¶å†…å®¹ç»™æ¨¡å‹                         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.4 æ¨¡å‹ç”Ÿæˆè¡¥ä¸                              â”‚        â”‚
â”‚  â”‚  {                                          â”‚        â”‚
â”‚  â”‚    "name": "shell",                         â”‚        â”‚
â”‚  â”‚    "arguments": {                           â”‚        â”‚
â”‚  â”‚      "cmd": ["apply_patch", "*** ..."]      â”‚        â”‚
â”‚  â”‚    }                                        â”‚        â”‚
â”‚  â”‚  }                                          â”‚        â”‚
â”‚  â”‚                                             â”‚        â”‚
â”‚  â”‚  â†’ è§£æè¡¥ä¸                                  â”‚        â”‚
â”‚  â”‚  â†’ æ˜¾ç¤ºå½©è‰² diff                             â”‚        â”‚
â”‚  â”‚  â†’ è¯·æ±‚ç”¨æˆ·ç¡®è®¤(å¦‚æœä¸æ˜¯ Full-Auto)           â”‚        â”‚
â”‚  â”‚  â†’ åº”ç”¨è¡¥ä¸åˆ°æ–‡ä»¶                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.5 éªŒè¯æ›´æ”¹                                  â”‚        â”‚
â”‚  â”‚  æ¨¡å‹å¯èƒ½æ‰§è¡Œ:                                â”‚        â”‚
â”‚  â”‚  â€¢ cargo check (è¯­æ³•æ£€æŸ¥)                    â”‚        â”‚
â”‚  â”‚  â€¢ cargo test (è¿è¡Œæµ‹è¯•)                     â”‚        â”‚
â”‚  â”‚  â€¢ git diff (æŸ¥çœ‹æ›´æ”¹)                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4.6 å®Œæˆæˆ–ç»§ç»­è¿­ä»£                            â”‚        â”‚
â”‚  â”‚  â€¢ å¦‚æœæµ‹è¯•é€šè¿‡ â†’ è¾“å‡ºå®Œæˆæ¶ˆæ¯                 â”‚        â”‚
â”‚  â”‚  â€¢ å¦‚æœæµ‹è¯•å¤±è´¥ â†’ ç»§ç»­å¾ªç¯ä¿®å¤                 â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: äº‹ä»¶è¿”å›                                         â”‚
â”‚  â€¢ é€šè¿‡ Event Queue å‘é€äº‹ä»¶ç»™ UI                         â”‚
â”‚  â€¢ EventMsg::Reasoning - æ˜¾ç¤ºæ¨ç†è¿‡ç¨‹                    â”‚
â”‚  â€¢ EventMsg::Message - æ˜¾ç¤ºæ–‡æœ¬è¾“å‡º                      â”‚
â”‚  â€¢ EventMsg::ToolCall - æ˜¾ç¤ºå·¥å…·è°ƒç”¨å’Œç»“æœ                â”‚
â”‚  â€¢ EventMsg::TurnComplete - ä»»åŠ¡å®Œæˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Submission/Event åè®®

Codex ä½¿ç”¨è‡ªå®šä¹‰çš„å¼‚æ­¥åè®®è§£è€¦è¯·æ±‚å’Œå“åº”:

```rust
// æäº¤ç±»å‹
enum Op {
    StartTurn {
        prompt: String,
        images: Vec<PathBuf>,
        context: TurnContext,
    },
    Cancel {
        submission_id: u64,
    },
    // ...
}

// äº‹ä»¶ç±»å‹
enum EventMsg {
    Reasoning {
        text: String,
    },
    Message {
        content: String,
    },
    ToolCall {
        tool: String,
        args: serde_json::Value,
    },
    ToolResult {
        output: String,
    },
    TurnComplete,
    Error {
        message: String,
    },
}

// æ ¸å¿ƒå¾ªç¯
async fn submission_loop(
    mut rx: mpsc::Receiver<Op>,
    tx: mpsc::UnboundedSender<EventMsg>,
) {
    while let Some(op) = rx.recv().await {
        match op {
            Op::StartTurn { prompt, context, .. } => {
                // è°ƒç”¨ Agent Loop
                execute_turn(&prompt, &context, &tx).await;
            }
            Op::Cancel { .. } => {
                // å–æ¶ˆæ‰§è¡Œ
                break;
            }
        }
    }
}
```

---

## é…ç½®ç³»ç»Ÿ

### äº”å±‚ä¼˜å…ˆçº§

Codex çš„é…ç½®ç³»ç»Ÿæ”¯æŒ 5 ä¸ªä¼˜å…ˆçº§å±‚:

```
1. å‘½ä»¤è¡Œå‚æ•° (æœ€é«˜ä¼˜å…ˆçº§)
   codex -c model=gpt-5-codex -c approval_mode=full-auto

2. ç¯å¢ƒå˜é‡
   export CODEX_MODEL=gpt-5-codex

3. é¡¹ç›®é…ç½® (.codex/config.toml)
   [default]
   model = "gpt-5-codex"
   approval_mode = "auto-edit"

4. ç”¨æˆ·å…¨å±€é…ç½® (~/.codex/config.toml)
   [default]
   model = "gpt-5"

5. å†…ç½®é»˜è®¤å€¼ (æœ€ä½ä¼˜å…ˆçº§)
```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```toml
# ~/.codex/config.toml

[default]
model = "gpt-5-codex"
model_provider = "openai"
approval_mode = "auto-edit"
sandbox = "workspace-write"
max_turns = 50

[profiles.strict]
approval_mode = "suggest"
sandbox = "read-only"

[profiles.ci]
approval_mode = "full-auto"
quiet = true

[mcp_servers.filesystem]
command = "mcp-server-filesystem"
args = ["--allowed-dirs", "/home/user/projects"]

[mcp_servers.github]
command = "mcp-server-github"
env = { GITHUB_TOKEN = "ghp_xxx" }
```

---

## MCP é›†æˆ

### ä»€ä¹ˆæ˜¯ MCP?

Model Context Protocol (MCP) æ˜¯ OpenAI å®šä¹‰çš„æ ‡å‡†åè®®,ç”¨äº AI Agent ä¹‹é—´çš„é€šä¿¡ã€‚

### Codex çš„åŒé‡è§’è‰²

#### 1. ä½œä¸º MCP å®¢æˆ·ç«¯

Codex å¯ä»¥è¿æ¥åˆ°å…¶ä»– MCP æœåŠ¡å™¨,æ‰©å±•å…¶èƒ½åŠ›:

```bash
# é…ç½® MCP æœåŠ¡å™¨
codex mcp add filesystem --command mcp-server-filesystem
codex mcp add github --command mcp-server-github
```

**æµç¨‹**:

```
Codex CLI  â†’  [MCP Protocol]  â†’  MCP Server (filesystem)
                                   â†“
                              è¯»å–æ–‡ä»¶/ç›®å½•
```

#### 2. ä½œä¸º MCP æœåŠ¡å™¨

å…¶ä»– Agent å¯ä»¥è°ƒç”¨ Codex:

```bash
# å¯åŠ¨ MCP æœåŠ¡å™¨æ¨¡å¼
codex mcp

# æˆ–è€…é€šè¿‡ npx
npx codex mcp
```

**åœ¨ Agents SDK ä¸­ä½¿ç”¨**:

```python
from agents import Agent
from agents.mcp import MCPServerStdio

async with MCPServerStdio(
    name="Codex CLI",
    params={
        "command": "npx",
        "args": ["-y", "codex", "mcp"]
    },
    client_session_timeout_seconds=360000
) as codex_mcp_server:

    agent = Agent(
        name="Developer",
        instructions="You are a coding assistant",
        mcp_servers=[codex_mcp_server]
    )

    # Agent ç°åœ¨å¯ä»¥è°ƒç”¨ Codex çš„èƒ½åŠ›
    result = await agent.run("Refactor this code")
```

### MCP å·¥å…·å®šä¹‰

Codex æš´éœ²çš„ MCP å·¥å…·:

```json
{
  "tools": [
    {
      "name": "codex_execute",
      "description": "Execute a coding task in Codex CLI",
      "inputSchema": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string",
            "description": "Task description"
          },
          "approval-policy": {
            "type": "string",
            "enum": ["suggest", "auto-edit", "full-auto", "never"]
          },
          "sandbox": {
            "type": "string",
            "enum": ["read-only", "workspace-write", "danger-full-access"]
          }
        },
        "required": ["prompt"]
      }
    }
  ]
}
```

---

## å¦‚ä½•å®ç°ç±»ä¼¼çš„ Agent

### ç¬¬ä¸€æ­¥:é€‰æ‹©æŠ€æœ¯æ ˆ

| ç»„ä»¶           | æ¨èé€‰é¡¹                               |
| -------------- | -------------------------------------- |
| **è¯­è¨€**       | Rust (æ€§èƒ½) æˆ– Python (å¿«é€Ÿå¼€å‘)       |
| **å¼‚æ­¥è¿è¡Œæ—¶** | Rust: tokio / Python: asyncio          |
| **CLI æ¡†æ¶**   | Rust: clap / Python: click             |
| **ç»ˆç«¯ UI**    | Rust: ratatui / Python: rich + textual |
| **LLM SDK**    | OpenAI SDK / Anthropic SDK             |

### ç¬¬äºŒæ­¥:å®ç°æ ¸å¿ƒå¾ªç¯

```python
# Python ç¤ºä¾‹
import openai
import asyncio
from typing import List, Dict

class CodingAgent:
    def __init__(self, model="gpt-4"):
        self.model = model
        self.history: List[Dict] = []
        self.system_prompt = """
        You are a coding assistant. You can:
        1. Execute shell commands using the 'shell' tool
        2. Apply patches to files using the 'apply_patch' tool

        Always verify your changes by running tests.
        """

    async def run(self, user_prompt: str):
        # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        self.history.append({
            "role": "user",
            "content": user_prompt
        })

        # ä¸»å¾ªç¯
        while True:
            # è°ƒç”¨ LLM
            response = await openai.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": self.system_prompt},
                    *self.history
                ],
                tools=[
                    {
                        "type": "function",
                        "function": {
                            "name": "shell",
                            "description": "Execute shell command",
                            "parameters": {
                                "type": "object",
                                "properties": {
                                    "cmd": {
                                        "type": "array",
                                        "items": {"type": "string"}
                                    }
                                },
                                "required": ["cmd"]
                            }
                        }
                    },
                    # ... å…¶ä»–å·¥å…·
                ]
            )

            message = response.choices[0].message

            # å¤„ç†å·¥å…·è°ƒç”¨
            if message.tool_calls:
                for tool_call in message.tool_calls:
                    result = await self.execute_tool(tool_call)

                    # æ·»åŠ å·¥å…·ç»“æœåˆ°å†å²
                    self.history.append({
                        "role": "tool",
                        "tool_call_id": tool_call.id,
                        "content": result
                    })

                # ç»§ç»­å¾ªç¯
                continue
            else:
                # æ²¡æœ‰å·¥å…·è°ƒç”¨,ä»»åŠ¡å®Œæˆ
                print(message.content)
                break

    async def execute_tool(self, tool_call):
        tool_name = tool_call.function.name
        args = json.loads(tool_call.function.arguments)

        if tool_name == "shell":
            return await self.run_shell(args["cmd"])
        elif tool_name == "apply_patch":
            return await self.apply_patch(args["patch"])

    async def run_shell(self, cmd: List[str]):
        # å®ç°æ²™ç®±æ‰§è¡Œ
        import subprocess
        result = subprocess.run(
            cmd,
            capture_output=True,
            text=True,
            timeout=30
        )
        return f"stdout: {result.stdout}\nstderr: {result.stderr}"
```

### ç¬¬ä¸‰æ­¥:å®ç°æ²™ç®±

```python
# ç®€å•çš„ Linux æ²™ç®±ç¤ºä¾‹
import subprocess
import tempfile
import os

class Sandbox:
    def __init__(self, work_dir: str):
        self.work_dir = work_dir

    def run_command(self, cmd: List[str]) -> str:
        # ä½¿ç”¨ firejail ä½œä¸ºç®€å•æ²™ç®±
        sandbox_cmd = [
            "firejail",
            "--quiet",
            "--private=" + self.work_dir,
            "--net=none",  # ç¦ç”¨ç½‘ç»œ
            "--",
            *cmd
        ]

        result = subprocess.run(
            sandbox_cmd,
            capture_output=True,
            text=True,
            timeout=30
        )

        return result.stdout + result.stderr
```

### ç¬¬å››æ­¥:å®ç°å®¡æ‰¹ç³»ç»Ÿ

```python
class ApprovalPolicy:
    SUGGEST = "suggest"
    AUTO_EDIT = "auto_edit"
    FULL_AUTO = "full_auto"

    def __init__(self, mode: str):
        self.mode = mode

    def should_approve(self, tool: str, args: dict) -> bool:
        if self.mode == self.FULL_AUTO:
            return True

        if self.mode == self.AUTO_EDIT:
            # è‡ªåŠ¨æ‰¹å‡†è¯»æ“ä½œå’Œå†™æ–‡ä»¶
            if tool == "shell":
                cmd = args["cmd"][0]
                return cmd in ["cat", "ls", "find", "grep"]
            elif tool == "apply_patch":
                return True

        # Suggest æ¨¡å¼:éƒ½éœ€è¦ç¡®è®¤
        return False

    def request_approval(self, tool: str, args: dict) -> bool:
        print(f"\nğŸ”” Approval needed:")
        print(f"Tool: {tool}")
        print(f"Args: {args}")

        response = input("Approve? (y/n): ")
        return response.lower() == 'y'
```

### ç¬¬äº”æ­¥:é›†æˆ MCP

```python
from mcp import Server, Tool

class CodexMCPServer:
    def __init__(self):
        self.server = Server()
        self.agent = CodingAgent()

        @self.server.tool()
        async def codex_execute(
            prompt: str,
            approval_policy: str = "suggest"
        ) -> str:
            """Execute a coding task"""
            self.agent.approval_mode = approval_policy
            result = await self.agent.run(prompt)
            return result

    async def run(self):
        await self.server.run(transport="stdio")

# å¯åŠ¨ MCP æœåŠ¡å™¨
if __name__ == "__main__":
    server = CodexMCPServer()
    asyncio.run(server.run())
```

### å®Œæ•´çš„æœ€å°å®ç°æ¡†æ¶

```
my-coding-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py              # CLI å…¥å£
â”‚   â”œâ”€â”€ agent.py             # Agent Loop
â”‚   â”œâ”€â”€ tools.py             # å·¥å…·å®ç°
â”‚   â”œâ”€â”€ sandbox.py           # æ²™ç®±å°è£…
â”‚   â”œâ”€â”€ approval.py          # å®¡æ‰¹ç³»ç»Ÿ
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ mcp_server.py        # MCP æœåŠ¡å™¨
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ system_prompt.txt    # System Prompt
â”œâ”€â”€ config.toml              # é»˜è®¤é…ç½®
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

### å…³é”®å®ç°è¦ç‚¹

1. **System Prompt è®¾è®¡**

   - ç®€æ´æ˜äº†,å®šä¹‰ Agent çš„"æ“ä½œç³»ç»Ÿ"
   - æ˜ç¡®å·¥å…·ä½¿ç”¨è§„èŒƒ
   - åŒ…å«å®‰å…¨çº¦æŸå’ŒéªŒè¯è¦æ±‚

2. **å·¥å…·ç³»ç»Ÿ**

   - ä¿æŒå·¥å…·æ•°é‡å°‘(5 ä¸ª)
   - ä½¿ç”¨ shell ä½œä¸ºé€šç”¨å·¥å…·
   - å®ç°ä¸“é—¨çš„æ–‡ä»¶ç¼–è¾‘å·¥å…·(diff-based)

3. **å®‰å…¨æœºåˆ¶**

   - å¤šå±‚é˜²æŠ¤:å®¡æ‰¹ + æ²™ç®± + ç½‘ç»œéš”ç¦»
   - é»˜è®¤æ‹’ç»,ç™½åå•å…è®¸
   - ç”¨æˆ·å¯æ§çš„å®‰å…¨çº§åˆ«

4. **ç”¨æˆ·ä½“éªŒ**

   - æµå¼è¾“å‡º,å®æ—¶åé¦ˆ
   - å½©è‰² diff æ˜¾ç¤º
   - æ¸…æ™°çš„å®¡æ‰¹ç•Œé¢

5. **å¯æ‰©å±•æ€§**
   - æ”¯æŒ MCP åè®®
   - æ’ä»¶åŒ–å·¥å…·ç³»ç»Ÿ
   - é…ç½®é©±åŠ¨çš„è¡Œä¸º

---

## æ¶æ„å›¾

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                                   â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚  å¼€å‘è€…   â”‚      â”‚   CI/CD  â”‚      â”‚  å…¶ä»– Agent  â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                    â”‚                â”‚
â”‚         â†“                 â†“                    â†“                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                    â”‚
         â†“                 â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¥å£å±‚                                      â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚   TUI    â”‚      â”‚   Exec   â”‚      â”‚  MCP Server  â”‚       â”‚
â”‚    â”‚(ç»ˆç«¯ç•Œé¢) â”‚      â”‚(æ— å¤´æ¨¡å¼) â”‚      â”‚ (stdioåè®®)   â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                    â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                           â†“                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¼‚æ­¥é€šä¿¡å±‚ (SQ/EQ)                              â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚  Submission Queue  â†â†’  Event Queue                â”‚       â”‚
â”‚    â”‚  (æäº¤é˜Ÿåˆ—)             (äº‹ä»¶é˜Ÿåˆ—)                  â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå¼•æ“ (codex-core)                       â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚            Agent Loop (ä¸»å¾ªç¯)                   â”‚         â”‚
â”‚    â”‚                                                 â”‚         â”‚
â”‚    â”‚  while not done:                                â”‚         â”‚
â”‚    â”‚    1. è°ƒç”¨ Responses API                         â”‚         â”‚
â”‚    â”‚    2. å¤„ç† reasoning/message/function_call      â”‚         â”‚
â”‚    â”‚    3. æ‰§è¡Œå·¥å…·                                   â”‚         â”‚
â”‚    â”‚    4. è¿½åŠ ç»“æœåˆ°å†å²                             â”‚         â”‚
â”‚    â”‚    5. æ£€æŸ¥å®Œæˆæ¡ä»¶                               â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚                                                â”‚          â”‚
â”‚    â†“                                                â†“          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Session    â”‚                          â”‚ TurnContext â”‚     â”‚
â”‚  â”‚  (ä¼šè¯ç®¡ç†)  â”‚                          â”‚  (å•è½®ä¸Šä¸‹æ–‡) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å·¥å…·æ‰§è¡Œå±‚                                 â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚  Shell   â”‚    â”‚  Patch   â”‚    â”‚   MCP å®¢æˆ·ç«¯  â”‚           â”‚
â”‚    â”‚  æ‰§è¡Œå™¨   â”‚    â”‚  åº”ç”¨å™¨   â”‚    â”‚   (å¤–éƒ¨å·¥å…·)  â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚               â”‚                  â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                         â†“                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®‰å…¨æ²™ç®±å±‚                                  â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚            å®¡æ‰¹ç­–ç•¥æ£€æŸ¥                       â”‚             â”‚
â”‚    â”‚  â€¢ Suggest: æ‰€æœ‰å†™æ“ä½œéœ€ç¡®è®¤                 â”‚             â”‚
â”‚    â”‚  â€¢ Auto-Edit: è‡ªåŠ¨åº”ç”¨æ–‡ä»¶æ›´æ”¹                â”‚             â”‚
â”‚    â”‚  â€¢ Full-Auto: å®Œå…¨è‡ªåŠ¨åŒ–                     â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                         â†“                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚          OS çº§æ²™ç®± (Seatbelt/Landlock)       â”‚             â”‚
â”‚    â”‚  â€¢ æ–‡ä»¶ç³»ç»Ÿé™åˆ¶: ä»… $PWD + $TMPDIR å¯å†™      â”‚             â”‚
â”‚    â”‚  â€¢ ç½‘ç»œéš”ç¦»: ä»…å…è®¸ api.openai.com          â”‚             â”‚
â”‚    â”‚  â€¢ ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ (Linux seccomp)              â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¤–éƒ¨æœåŠ¡å±‚                                   â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚ OpenAI API   â”‚    â”‚   æ–‡ä»¶ç³»ç»Ÿ    â”‚    â”‚   Git    â”‚       â”‚
â”‚    â”‚ (Responses)  â”‚    â”‚   (è¯»/å†™)     â”‚    â”‚  (ç‰ˆæœ¬æ§åˆ¶)â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent Loop æµç¨‹å›¾

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ç”¨æˆ·è¾“å…¥æç¤º       â”‚
        â”‚  "Add error handling" â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æ„å»ºä¸Šä¸‹æ–‡          â”‚
        â”‚ â€¢ System Prompt      â”‚
        â”‚ â€¢ å†å²æ¶ˆæ¯           â”‚
        â”‚ â€¢ é¡¹ç›®æ–‡æ¡£(AGENTS.md) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è°ƒç”¨ Responses API   â”‚
        â”‚  (æµå¼å“åº”)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è§£æå“åº”ç±»å‹         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reasoning    â”‚    â”‚   Message    â”‚
â”‚   (æ¨ç†è¿‡ç¨‹)    â”‚    â”‚  (æ–‡æœ¬è¾“å‡º)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                   â†“
    (æ˜¾ç¤ºæ¨ç†)           (æ˜¾ç¤ºæ¶ˆæ¯)
         â†“                   â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Function Call?     â”‚
        â”‚   (å·¥å…·è°ƒç”¨)          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
              â”‚  æ˜¯å¦?   â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â†“             â†“
          ã€æ˜¯ã€‘         ã€å¦ã€‘
            â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è§£æå·¥å…·è°ƒç”¨    â”‚  â”‚  ä»»åŠ¡å®Œæˆ     â”‚
â”‚ â€¢ shell          â”‚  â”‚  è¾“å‡ºç»“æœ     â”‚
â”‚ â€¢ apply_patch    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥å®¡æ‰¹ç­–ç•¥     â”‚
â”‚ â€¢ éœ€è¦ç¡®è®¤?      â”‚
â”‚ â€¢ è‡ªåŠ¨æ‰¹å‡†?      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â†“           â†“
ã€éœ€ç¡®è®¤ã€‘   ã€è‡ªåŠ¨æ‰¹å‡†ã€‘
    â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ æ˜¾ç¤º UI â”‚   â”‚
â”‚ ç­‰å¾…ç¡®è®¤â”‚   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
     â†“        â†“
  â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
  â”‚  åœ¨æ²™ç®±ä¸­æ‰§è¡Œ  â”‚
  â”‚  è·å–è¾“å‡º     â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¿½åŠ åˆ°å†å²   â”‚
  â”‚ â€¢ Tool Call  â”‚
  â”‚ â€¢ Tool Resultâ”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç»§ç»­å¾ªç¯     â”‚
  â”‚  (å›åˆ° API)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    (è¿”å›é¡¶éƒ¨)
```

### å·¥å…·æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ¨¡å‹ç”Ÿæˆå·¥å…·è°ƒç”¨                         â”‚
â”‚  {                                              â”‚
â”‚    "name": "shell",                            â”‚
â”‚    "arguments": {"cmd": ["cat", "main.rs"]}    â”‚
â”‚  }                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å·¥å…·åˆ†å‘å™¨ (Tool Dispatcher)          â”‚
â”‚  â€¢ è¯†åˆ«å·¥å…·ç±»å‹                                  â”‚
â”‚  â€¢ è§£æå‚æ•°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
              â”‚   å·¥å…·ç±»å‹?  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  shell   â”‚            â”‚ apply_patch  â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†ç±»å‘½ä»¤ç±»å‹  â”‚          â”‚  è§£æè¡¥ä¸     â”‚
â”‚ â€¢ è¯»æ“ä½œ     â”‚          â”‚  æ ¼å¼         â”‚
â”‚ â€¢ å†™æ“ä½œ     â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ å±é™©æ“ä½œ   â”‚                 â†“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â†“                  â”‚  ç”Ÿæˆ diff   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  é¢„è§ˆ        â”‚
â”‚ å®¡æ‰¹ç­–ç•¥æ£€æŸ¥  â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚                 â†“
â”‚ Suggest:     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰€æœ‰éœ€ç¡®è®¤   â”‚          â”‚  å®¡æ‰¹æ£€æŸ¥     â”‚
â”‚              â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Auto-Edit:   â”‚                 â†“
â”‚  è¯»è‡ªåŠ¨æ‰¹å‡†   â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†™éœ€ç¡®è®¤     â”‚          â†“              â†“
â”‚              â”‚      ã€éœ€ç¡®è®¤ã€‘      ã€è‡ªåŠ¨ã€‘
â”‚ Full-Auto:   â”‚          â†“              â†“
â”‚  å…¨è‡ªåŠ¨      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ æ˜¾ç¤º UI  â”‚        â”‚
       â†“            â”‚ ç­‰å¾…è¾“å…¥ â”‚        â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
   â†“       â†“             â†“              â†“
ã€éœ€ç¡®è®¤ã€‘ã€è‡ªåŠ¨ã€‘      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
   â†“       â†“          â”‚   åº”ç”¨æ–‡ä»¶æ›´æ”¹      â”‚
   â”‚       â”‚          â”‚   (fs æ“ä½œ)        â”‚
   â”‚       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“       â†“                    â†“
â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºç¡®è®¤ UI  â”‚          â”‚  è¿”å›ç»“æœ     â”‚
â”‚ â€¢ å‘½ä»¤å†…å®¹   â”‚          â”‚  ç»™æ¨¡å‹       â”‚
â”‚ â€¢ é£é™©è¯„ä¼°   â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚ ç”¨æˆ·å†³å®š â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â†“
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â†“       â†“
ã€æ‰¹å‡†ã€‘  ã€æ‹’ç»ã€‘
   â†“       â†“
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚    â”‚è¿”å›é”™è¯¯â”‚
   â”‚    â””â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ¨æ²™ç®±ä¸­æ‰§è¡Œ     â”‚
â”‚                 â”‚
â”‚ macOS:          â”‚
â”‚  sandbox-exec   â”‚
â”‚                 â”‚
â”‚ Linux:          â”‚
â”‚  Landlock       â”‚
â”‚  + seccomp      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•è·è¾“å‡º         â”‚
â”‚ â€¢ stdout        â”‚
â”‚ â€¢ stderr        â”‚
â”‚ â€¢ exit code     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¼å¼åŒ–ç»“æœ       â”‚
â”‚  è¿”å›ç»™ Agent    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ€»ç»“

### Codex çš„æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç®€æ´æ€§** - å°‘å³æ˜¯å¤š

   - æœ€å°åŒ–å·¥å…·æ•°é‡
   - ç®€åŒ– System Prompt
   - Shell-first è®¾è®¡å“²å­¦

2. **å®‰å…¨æ€§** - çºµæ·±é˜²å¾¡

   - åº”ç”¨çº§å®¡æ‰¹ç­–ç•¥
   - OS çº§æ²™ç®±éš”ç¦»
   - ç½‘ç»œè®¿é—®æ§åˆ¶
   - æ–‡ä»¶ç³»ç»Ÿé™åˆ¶

3. **å¯è§‚æµ‹æ€§** - é€æ˜æ‰§è¡Œ

   - æµå¼è¾“å‡ºæ¨ç†è¿‡ç¨‹
   - å½©è‰² diff é¢„è§ˆ
   - è¯¦ç»†çš„å·¥å…·è°ƒç”¨æ—¥å¿—

4. **å¯æ‰©å±•æ€§** - æ¨¡å—åŒ–è®¾è®¡
   - MCP åè®®æ”¯æŒ
   - é…ç½®é©±åŠ¨è¡Œä¸º
   - æ’ä»¶åŒ–å·¥å…·ç³»ç»Ÿ

### å®ç°å»ºè®®

å¦‚æœä½ æƒ³æ„å»ºç±»ä¼¼çš„ Coding Agent,å…³é”®æ­¥éª¤æ˜¯:

1. **ä»æœ€å° MVP å¼€å§‹**

   - å®ç°åŸºæœ¬çš„ Agent Loop
   - æ”¯æŒ 1-2 ä¸ªæ ¸å¿ƒå·¥å…·
   - æ·»åŠ ç®€å•çš„æ²™ç®±

2. **è¿­ä»£æ”¹è¿›**

   - ä¼˜åŒ– System Prompt
   - å¢å¼ºå®‰å…¨æœºåˆ¶
   - æ”¹å–„ç”¨æˆ·ä½“éªŒ

3. **é›†æˆç”Ÿæ€**

   - æ”¯æŒ MCP åè®®
   - è¿æ¥ IDE/CI/CD
   - æ„å»ºå·¥å…·åº“

4. **æŒç»­å­¦ä¹ **
   - ç ”ç©¶å¼€æºé¡¹ç›®(Codex CLI, Claude Code)
   - å‚è€ƒæœ€ä½³å®è·µ
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

### å‚è€ƒèµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://developers.openai.com/codex
- **GitHub ä»“åº“**: https://github.com/openai/codex
- **OpenAI Cookbook**: https://cookbook.openai.com
- **MCP åè®®**: https://modelcontextprotocol.io

---

## é™„å½•:æŠ€æœ¯ç»†èŠ‚

### A. Responses API è¯¦è§£

Codex ä½¿ç”¨ OpenAI çš„ Responses API(è€Œéæ ‡å‡†çš„ Chat Completions API):

```python
# Responses API è¯·æ±‚
POST /v1/responses
{
  "model": "gpt-5-codex",
  "messages": [...],
  "tools": [...],
  "stream": true,
  "previous_response_id": "resp_abc123"  # ç”¨äºç»­ä¼ 
}

# æµå¼å“åº”äº‹ä»¶
event: response.output_item.done
data: {
  "type": "reasoning",
  "content": "I need to read the file first..."
}

event: response.output_item.done
data: {
  "type": "function_call",
  "name": "shell",
  "arguments": "{\"cmd\": [\"cat\", \"main.rs\"]}"
}
```

### B. Rust Crate ä¾èµ–å…³ç³»

```
codex-rs/cli
â”œâ”€â”€ codex-rs/core
â”‚   â”œâ”€â”€ codex-rs/protocol
â”‚   â”œâ”€â”€ codex-rs/login
â”‚   â”œâ”€â”€ codex-rs/config
â”‚   â””â”€â”€ codex-rs/sandbox
â”‚       â”œâ”€â”€ codex-rs/macos-seatbelt
â”‚       â””â”€â”€ codex-rs/linux-sandbox
â”œâ”€â”€ codex-rs/tui
â””â”€â”€ codex-rs/exec
```

### C. æ€§èƒ½ä¼˜åŒ–ç‚¹

1. **é™æ€é“¾æ¥** - æ— è¿è¡Œæ—¶ä¾èµ–
2. **é›¶æ‹·è´** - ä½¿ç”¨ `bytes` crate
3. **å¼‚æ­¥ I/O** - tokio è¿è¡Œæ—¶
4. **æµå¼å¤„ç†** - å¢é‡è§£æ JSON
5. **ç¼“å­˜ç­–ç•¥** - ç¼“å­˜æ¨¡å‹åˆ—è¡¨å’Œé…ç½®

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-12  
**ä½œè€…**: Claude (åŸºäº OpenAI Codex å…¬å¼€èµ„æ–™æ•´ç†)
