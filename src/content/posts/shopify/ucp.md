---
title: 'Universal Commerce Protocol (UCP)ï¼šShopify ä¸ Google è”åˆæ‰“é€ çš„ AI ç”µå•†æ ‡å‡†'
date: '2026-01-21'
excerpt: 'æ·±å…¥è§£æ Shopify å’Œ Google å…±åŒå¼€å‘çš„ Universal Commerce Protocol (UCP)ï¼Œæ¢ç´¢å¦‚ä½•é€šè¿‡å¼€æ”¾åè®®å®ç° AI Agent ä¸å•†å®¶çš„æ— ç¼äº¤æ˜“ï¼Œä»¥åŠ UCP çš„æ¶æ„è®¾è®¡ã€æ ¸å¿ƒèƒ½åŠ›å’Œå®ç°ç»†èŠ‚ã€‚'
tags: ['Shopify', 'E-commerce', 'AI', 'Protocol']
series: 'Shopify'
---

# Universal Commerce Protocol (UCP)ï¼šShopify ä¸ Google è”åˆæ‰“é€ çš„ AI ç”µå•†æ ‡å‡†

## ç›®å½•

1. [å¼•è¨€](#1-å¼•è¨€)
2. [UCP æ ¸å¿ƒæ¦‚å¿µ](#2-ucp-æ ¸å¿ƒæ¦‚å¿µ)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [èƒ½åŠ›ä¸æ‰©å±•ç³»ç»Ÿ](#4-èƒ½åŠ›ä¸æ‰©å±•ç³»ç»Ÿ)
5. [åä½œæœºåˆ¶](#5-åä½œæœºåˆ¶)
6. [æ”¯ä»˜æ¶æ„](#6-æ”¯ä»˜æ¶æ„)
7. [æŠ€æœ¯å®ç°](#7-æŠ€æœ¯å®ç°)
8. [Google é›†æˆ](#8-google-é›†æˆ)
9. [æœ€ä½³å®è·µ](#9-æœ€ä½³å®è·µ)
10. [æ€»ç»“](#10-æ€»ç»“)

---

## 1. å¼•è¨€

### 1.1 ä»€ä¹ˆæ˜¯ UCP

**Universal Commerce Protocol (UCP)** æ˜¯ç”± Shopify å’Œ Google è”åˆå¼€å‘çš„å¼€æºæ ‡å‡†åè®®ï¼Œæ—¨åœ¨ä¸º **AI Agent é©±åŠ¨çš„ç”µå•†**ï¼ˆAgentic Commerceï¼‰æä¾›ç»Ÿä¸€çš„äº¤äº’è¯­è¨€ã€‚

> **æ ¸å¿ƒä½¿å‘½**: è®© AI Agent èƒ½å¤Ÿå‘ç°ã€åå•†å¹¶ä¸ä»»ä½•å•†å®¶å®Œæˆäº¤æ˜“ï¼Œæ— éœ€ä¸ºæ¯ä¸ªå¹³å°å•ç‹¬é›†æˆã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ UCP

#### ä¼ ç»Ÿç”µå•†é›†æˆçš„å›°å¢ƒ

```mermaid
graph TD
    A[AI Agent 1] -->|å®šåˆ¶é›†æˆ| B[å•†å®¶ A]
    A -->|å®šåˆ¶é›†æˆ| C[å•†å®¶ B]
    A -->|å®šåˆ¶é›†æˆ| D[å•†å®¶ C]
    
    E[AI Agent 2] -->|å®šåˆ¶é›†æˆ| B
    E -->|å®šåˆ¶é›†æˆ| C
    E -->|å®šåˆ¶é›†æˆ| D
    
    F[AI Agent 3] -->|å®šåˆ¶é›†æˆ| B
    F -->|å®šåˆ¶é›†æˆ| C
    F -->|å®šåˆ¶é›†æˆ| D
    
    style A fill:#f9f,stroke:#333
    style E fill:#f9f,stroke:#333
    style F fill:#f9f,stroke:#333
```

**é—®é¢˜**ï¼š
- âŒ N Ã— N é›†æˆå¤æ‚åº¦
- âŒ æ¯ä¸ª Agent éœ€è¦ä¸ºæ¯ä¸ªå•†å®¶å®šåˆ¶
- âŒ ç¼ºä¹æ ‡å‡†åŒ–ï¼Œç»´æŠ¤æˆæœ¬é«˜
- âŒ æ— æ³•å¿«é€Ÿé€‚åº”æ–°çš„ AI ä½“éªŒ

#### UCP çš„è§£å†³æ–¹æ¡ˆ

```mermaid
graph TD
    A[AI Agent 1] -->|UCP| G[UCP åè®®å±‚]
    E[AI Agent 2] -->|UCP| G
    F[AI Agent 3] -->|UCP| G
    
    G -->|UCP| B[å•†å®¶ A]
    G -->|UCP| C[å•†å®¶ B]
    G -->|UCP| D[å•†å®¶ C]
    
    style G fill:#9f9,stroke:#333
```

**ä¼˜åŠ¿**ï¼š
- âœ… å•ä¸€é›†æˆç‚¹
- âœ… æ ‡å‡†åŒ–åè®®
- âœ… åŠ¨æ€èƒ½åŠ›åå•†
- âœ… å¯æ‰©å±•æ¶æ„

### 1.3 ç”Ÿæ€ç³»ç»Ÿæ”¯æŒ

UCP å¾—åˆ°äº†å…¨çƒ 20+ åˆä½œä¼™ä¼´çš„æ”¯æŒï¼š

**é›¶å”®å•†**: Shopify, Etsy, Wayfair, Target, Walmart, Best Buy, Flipkart, Macy's, The Home Depot, Zalando

**æ”¯ä»˜æä¾›å•†**: Adyen, American Express, Mastercard, Stripe, Visa

**æŠ€æœ¯å¹³å°**: Google (AI Mode in Search, Gemini)

---

## 2. UCP æ ¸å¿ƒæ¦‚å¿µ

### 2.1 åè®®åˆ†å±‚æ¶æ„

UCP é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œç±»ä¼¼äº TCP/IP åè®®æ ˆï¼š

```mermaid
graph TD
    A[ä¼ è¾“å±‚ Transport] --> B[æœåŠ¡å±‚ Services]
    B --> C[èƒ½åŠ›å±‚ Capabilities]
    C --> D[æ‰©å±•å±‚ Extensions]
    
    A1[REST / GraphQL / JSON-RPC / A2A / MCP] --> A
    B1[Shopping Service / Future Services] --> B
    C1[Checkout / Orders / Catalog] --> C
    D1[Fulfillment / Discount / Custom] --> D
```

**åˆ†å±‚èŒè´£**ï¼š

| å±‚çº§ | èŒè´£ | ç¤ºä¾‹ |
|------|------|------|
| **ä¼ è¾“å±‚** | å®šä¹‰é€šä¿¡åè®® | REST API, GraphQL, MCP |
| **æœåŠ¡å±‚** | å®šä¹‰æ ¸å¿ƒäº¤æ˜“åŸè¯­ | Shopping Service |
| **èƒ½åŠ›å±‚** | å®šä¹‰ä¸»è¦åŠŸèƒ½é¢†åŸŸ | Checkout, Orders, Catalog |
| **æ‰©å±•å±‚** | é¢†åŸŸç‰¹å®šå¢å¼º | Fulfillment, Discount, Loyalty |

### 2.2 æ ¸å¿ƒåŸè¯­

```typescript
// Shopping Service æ ¸å¿ƒåŸè¯­
interface ShoppingService {
  // ç»“è´¦ä¼šè¯
  checkoutSession: {
    id: string;
    lineItems: LineItem[];
    totals: Total[];
    status: CheckoutStatus;
  };
  
  // è¡Œé¡¹ç›®
  lineItem: {
    id: string;
    item: Product;
    quantity: number;
    totals: Total[];
  };
  
  // æ¶ˆæ¯
  messages: Message[];
  
  // çŠ¶æ€
  status: 'incomplete' | 'requires_escalation' | 'ready_for_complete';
}
```

### 2.3 èƒ½åŠ›å‘ç°ä¸åå•†

UCP çš„æ ¸å¿ƒæœºåˆ¶æ˜¯**åŠ¨æ€èƒ½åŠ›å‘ç°**å’Œ**åŒå‘åå•†**ï¼š

```mermaid
sequenceDiagram
    participant Agent
    participant Merchant
    
    Agent->>Merchant: GET /.well-known/ucp
    Merchant->>Agent: è¿”å›å•†å®¶ Profile
    
    Note over Agent: è§£æå•†å®¶èƒ½åŠ›
    
    Agent->>Merchant: POST /checkout-sessions<br/>é™„å¸¦ Agent Profile
    
    Note over Merchant: è®¡ç®—èƒ½åŠ›äº¤é›†
    
    Merchant->>Agent: è¿”å›åå•†åçš„èƒ½åŠ›
```

---

## 3. æ¶æ„è®¾è®¡

### 3.1 Profile æœºåˆ¶

#### å•†å®¶ Profile

å•†å®¶åœ¨ `/.well-known/ucp` å‘å¸ƒå…¶æ”¯æŒçš„èƒ½åŠ›ï¼š

```json
{
  "ucp": {
    "version": "2026-01-11",
    "services": {
      "dev.ucp.shopping": {
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specs/shopping",
        "rest": {
          "schema": "https://ucp.dev/services/shopping/openapi.json",
          "endpoint": "https://merchant.example.com/"
        }
      }
    },
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specs/shopping/checkout"
      },
      {
        "name": "dev.ucp.shopping.discount",
        "version": "2026-01-11",
        "extends": "dev.ucp.shopping.checkout"
      },
      {
        "name": "com.loyaltyprovider.points",
        "version": "1.0.0",
        "extends": "dev.ucp.shopping.checkout"
      }
    ]
  },
  "payment": {
    "handlers": [
      {
        "id": "shop_pay",
        "name": "com.shopify.shop_pay",
        "version": "2026-01-11"
      },
      {
        "id": "google_pay",
        "name": "google.pay",
        "version": "2026-01-11"
      }
    ]
  }
}
```

#### Agent Profile

Agent ä¹Ÿå£°æ˜å…¶æ”¯æŒçš„èƒ½åŠ›ï¼š

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      },
      {
        "name": "dev.ucp.shopping.discount",
        "version": "2026-01-11"
      }
    ]
  },
  "payment": {
    "handlers": [
      {
        "id": "google_pay",
        "name": "google.pay"
      }
    ]
  }
}
```

### 3.2 èƒ½åŠ›åå•†æµç¨‹

```typescript
// åå•†ç®—æ³•
function negotiateCapabilities(
  merchantProfile: Profile,
  agentProfile: Profile
): NegotiatedCapabilities {
  // 1. è®¡ç®—èƒ½åŠ›äº¤é›†
  const commonCapabilities = intersection(
    merchantProfile.capabilities,
    agentProfile.capabilities
  );
  
  // 2. è®¡ç®—æ”¯ä»˜å¤„ç†å™¨äº¤é›†
  const commonHandlers = intersection(
    merchantProfile.payment.handlers,
    agentProfile.payment.handlers
  );
  
  // 3. è¿”å›åå•†ç»“æœ
  return {
    capabilities: commonCapabilities,
    paymentHandlers: commonHandlers
  };
}
```

**ç¤ºä¾‹**ï¼š

```
å•†å®¶æ”¯æŒ: [checkout, discount, fulfillment, loyalty]
Agent æ”¯æŒ: [checkout, discount]

åå•†ç»“æœ: [checkout, discount]
```

### 3.3 å‘½åç©ºé—´ç®¡ç†

UCP ä½¿ç”¨**åå‘åŸŸåå‘½å**é¿å…ä¸­å¿ƒåŒ–å®¡æ‰¹ï¼š

```typescript
// å®˜æ–¹èƒ½åŠ›
dev.ucp.shopping.checkout       // ç”± ucp.dev ç®¡ç†
dev.ucp.shopping.discount       // ç”± ucp.dev ç®¡ç†

// ç¬¬ä¸‰æ–¹æ‰©å±•
com.shopify.shop_pay            // ç”± shopify.com ç®¡ç†
com.loyaltyprovider.points      // ç”± loyaltyprovider.com ç®¡ç†
com.stripe.payment              // ç”± stripe.com ç®¡ç†
```

**éªŒè¯æœºåˆ¶**ï¼š

```typescript
function validateCapability(capability: string): boolean {
  // 1. è§£æå‘½åç©ºé—´
  const namespace = capability.split('.').slice(0, -1).reverse().join('.');
  
  // 2. éªŒè¯åŸŸåæ‰€æœ‰æƒ
  const domain = namespace;
  const isOwned = verifyDomainOwnership(domain);
  
  return isOwned;
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€ä¸­å¿ƒåŒ–å®¡æ‰¹
- âœ… è‡ªç”±æ‰©å±•
- âœ… å‘½åç©ºé—´éš”ç¦»
- âœ… å®‰å…¨å¯éªŒè¯

---

## 4. èƒ½åŠ›ä¸æ‰©å±•ç³»ç»Ÿ

### 4.1 æ ¸å¿ƒèƒ½åŠ›

#### Checkout èƒ½åŠ›

```typescript
interface CheckoutCapability {
  name: 'dev.ucp.shopping.checkout';
  
  // åˆ›å»ºç»“è´¦ä¼šè¯
  createSession(request: CheckoutRequest): Promise<CheckoutSession>;
  
  // æ›´æ–°ç»“è´¦ä¼šè¯
  updateSession(id: string, updates: Partial<CheckoutRequest>): Promise<CheckoutSession>;
  
  // å®Œæˆç»“è´¦
  completeSession(id: string, payment: PaymentInstrument): Promise<Order>;
}

interface CheckoutSession {
  id: string;
  lineItems: LineItem[];
  buyer: Buyer;
  status: 'incomplete' | 'requires_escalation' | 'ready_for_complete';
  currency: string;
  totals: Total[];
  payment: PaymentConfig;
}
```

#### Orders èƒ½åŠ›

```typescript
interface OrdersCapability {
  name: 'dev.ucp.shopping.orders';
  
  // è·å–è®¢å•
  getOrder(id: string): Promise<Order>;
  
  // åˆ—å‡ºè®¢å•
  listOrders(filters: OrderFilters): Promise<Order[]>;
  
  // å–æ¶ˆè®¢å•
  cancelOrder(id: string): Promise<Order>;
}
```

### 4.2 æ‰©å±•æœºåˆ¶

æ‰©å±•é€šè¿‡**ç»„åˆ**å¢å¼ºæ ¸å¿ƒèƒ½åŠ›ï¼š

#### Fulfillment æ‰©å±•

```typescript
// æ ¸å¿ƒ Checkout Schema
interface CheckoutSession {
  id: string;
  lineItems: LineItem[];
  totals: Total[];
}

// Fulfillment æ‰©å±•
interface FulfillmentExtension {
  extends: 'dev.ucp.shopping.checkout';
  
  // æ‰©å±•å­—æ®µ
  fulfillmentGroups?: FulfillmentGroup[];
}

interface FulfillmentGroup {
  id: string;
  lineItems: string[];  // å¼•ç”¨ line item IDs
  options: FulfillmentOption[];
  selected?: string;
}

interface FulfillmentOption {
  id: string;
  type: 'shipping' | 'pickup' | 'delivery';
  provider: string;
  cost: number;
  estimatedDelivery?: DateRange;
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```json
{
  "id": "checkout_123",
  "lineItems": [...],
  "totals": [...],
  
  // Fulfillment æ‰©å±•å­—æ®µ
  "fulfillmentGroups": [
    {
      "id": "group_1",
      "lineItems": ["item_1", "item_2"],
      "options": [
        {
          "id": "shipping_standard",
          "type": "shipping",
          "provider": "USPS",
          "cost": 500,
          "estimatedDelivery": {
            "start": "2026-01-25",
            "end": "2026-01-28"
          }
        },
        {
          "id": "pickup_store",
          "type": "pickup",
          "provider": "Store #123",
          "cost": 0
        }
      ],
      "selected": "shipping_standard"
    }
  ]
}
```

#### Discount æ‰©å±•

```typescript
interface DiscountExtension {
  extends: 'dev.ucp.shopping.checkout';
  
  discounts?: {
    codes?: string[];
    applied?: AppliedDiscount[];
  };
}

interface AppliedDiscount {
  code: string;
  title: string;
  amount: number;
  automatic: boolean;
  allocations: DiscountAllocation[];
}
```

### 4.3 ç‰ˆæœ¬ç®¡ç†

æ¯ä¸ªèƒ½åŠ›å’Œæ‰©å±•ç‹¬ç«‹ç‰ˆæœ¬åŒ–ï¼š

```json
{
  "capabilities": [
    {
      "name": "dev.ucp.shopping.checkout",
      "version": "2026-01-11"
    },
    {
      "name": "dev.ucp.shopping.fulfillment",
      "version": "2026-01-15"  // ç‹¬ç«‹ç‰ˆæœ¬
    }
  ]
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ ¸å¿ƒä¿æŒç¨³å®š
- âœ… æ‰©å±•ç‹¬ç«‹æ¼”è¿›
- âœ… å‘åå…¼å®¹
- âœ… æ¸è¿›å¼å‡çº§

---

## 5. åä½œæœºåˆ¶

### 5.1 Checkout çŠ¶æ€æœº

```mermaid
stateDiagram-v2
    [*] --> incomplete
    incomplete --> requires_escalation: ç¼ºå°‘å¿…è¦ä¿¡æ¯
    incomplete --> ready_for_complete: ä¿¡æ¯å®Œæ•´
    requires_escalation --> ready_for_complete: Agent è§£å†³æˆ–ç”¨æˆ·è¡¥å……
    ready_for_complete --> [*]: å®Œæˆæ”¯ä»˜
```

**çŠ¶æ€è¯´æ˜**ï¼š

| çŠ¶æ€ | å«ä¹‰ | Agent è¡Œä¸º |
|------|------|-----------|
| `incomplete` | ç¼ºå°‘å¿…è¦ä¿¡æ¯ | å°è¯•é€šè¿‡ API è¡¥å…… |
| `requires_escalation` | éœ€è¦ç”¨æˆ·ä»‹å…¥ | è°ƒç”¨ `continue_url` ç§»äº¤ |
| `ready_for_complete` | å¯ä»¥å®Œæˆ | è°ƒç”¨å®Œæˆ API |

### 5.2 äººæœºåä½œ (Handoff)

å½“ Agent é‡åˆ°æ— æ³•å¤„ç†çš„æƒ…å†µæ—¶ï¼Œé€šè¿‡ `continue_url` ç§»äº¤ç»™ç”¨æˆ·ï¼š

```json
{
  "status": "requires_escalation",
  "messages": [
    {
      "type": "error",
      "text": "éœ€è¦éªŒè¯å¹´é¾„ä»¥è´­ä¹°æ­¤å•†å“"
    }
  ],
  "links": [
    {
      "rel": "continue",
      "href": "https://merchant.example.com/checkout/abc123"
    }
  ]
}
```

**Handoff æµç¨‹**ï¼š

```mermaid
sequenceDiagram
    participant User
    participant Agent
    participant Merchant
    
    User->>Agent: "è´­ä¹°çº¢é…’"
    Agent->>Merchant: POST /checkout-sessions
    Merchant->>Agent: status: requires_escalation<br/>continue_url
    
    Agent->>User: æ˜¾ç¤ºåµŒå…¥å¼ç»“è´¦
    User->>Merchant: å®Œæˆå¹´é¾„éªŒè¯
    Merchant->>Agent: æ›´æ–°çŠ¶æ€
    Agent->>Merchant: å®Œæˆæ”¯ä»˜
```

### 5.3 Embedded Checkout Protocol (ECP)

ECP ä½¿ç§»äº¤æ— ç¼è¡”æ¥ï¼š

```typescript
// Agent åŠ è½½åµŒå…¥å¼ç»“è´¦
const iframe = document.createElement('iframe');
iframe.src = checkoutResponse.links.find(l => l.rel === 'continue').href;

// å»ºç«‹ JSON-RPC 2.0 é€šé“
const channel = new MessageChannel();
iframe.contentWindow.postMessage({
  type: 'init',
  port: channel.port2
}, '*', [channel.port2]);

// åŒå‘é€šä¿¡
channel.port1.onmessage = (event) => {
  if (event.data.method === 'requestPayment') {
    // Agent æä¾›æ”¯ä»˜å‡­è¯
    const paymentInstrument = await getPaymentInstrument();
    channel.port1.postMessage({
      id: event.data.id,
      result: paymentInstrument
    });
  }
};
```

**ECP èƒ½åŠ›**ï¼š
- âœ… åŒå‘æ¶ˆæ¯ä¼ é€’
- âœ… æ”¯ä»˜å‡­è¯å…±äº«
- âœ… åœ°å€ä¿¡æ¯å…±äº«
- âœ… PCI v4 åˆè§„
- âœ… å“ç‰Œå®šåˆ¶

---

## 6. æ”¯ä»˜æ¶æ„

### 6.1 æ”¯ä»˜å¤„ç†å™¨ (Payment Handlers)

UCP å°†**æ”¯ä»˜å·¥å…·**ï¼ˆç”¨æˆ·ç”¨ä»€ä¹ˆæ”¯ä»˜ï¼‰ä¸**æ”¯ä»˜å¤„ç†å™¨**ï¼ˆè°å¤„ç†æ”¯ä»˜ï¼‰åˆ†ç¦»ï¼š

```mermaid
graph LR
    A[æ”¯ä»˜å·¥å…·<br/>Payment Instrument] --> B[æ”¯ä»˜å¤„ç†å™¨<br/>Payment Handler]
    B --> C[æ”¯ä»˜æœåŠ¡å•†<br/>PSP]
    
    A1[ä¿¡ç”¨å¡] --> A
    A2[Google Pay] --> A
    A3[Shop Pay] --> A
    
    B1[Stripe] --> B
    B2[Adyen] --> B
    B3[Shopify Payments] --> B
```

### 6.2 åŠ¨æ€æ”¯ä»˜åå•†

```typescript
// Agent Profile
const agentProfile = {
  payment: {
    instruments: [
      {
        type: 'google_pay',
        schema: 'https://ucp.dev/schemas/gpay_instrument.json'
      },
      {
        type: 'card',
        schema: 'https://ucp.dev/schemas/card_instrument.json'
      }
    ]
  }
};

// Merchant Profile
const merchantProfile = {
  payment: {
    handlers: [
      {
        id: 'shop_pay',
        name: 'com.shopify.shop_pay',
        instrumentSchemas: ['https://shopify.dev/ucp/shop_pay/instrument.json']
      },
      {
        id: 'google_pay',
        name: 'google.pay',
        instrumentSchemas: ['https://ucp.dev/schemas/gpay_instrument.json']
      }
    ]
  }
};

// åå•†ç»“æœ
const negotiated = {
  availableHandlers: ['google_pay'],  // åŒæ–¹éƒ½æ”¯æŒ
  userChoice: 'google_pay'  // ç”¨æˆ·é€‰æ‹©
};
```

### 6.3 æ”¯ä»˜å¤„ç†å™¨æ‰©å±•

ä»»ä½•æ”¯ä»˜æä¾›å•†éƒ½å¯ä»¥å‘å¸ƒè‡ªå·±çš„ Handlerï¼š

```typescript
// Stripe Handler å®šä¹‰
interface StripeHandler {
  id: 'stripe';
  name: 'com.stripe.payment';
  version: '2026-01-11';
  spec: 'https://stripe.com/ucp/handler/spec';
  
  configSchema: {
    publishableKey: string;
    accountId: string;
  };
  
  instrumentSchemas: [
    'https://stripe.com/ucp/card_instrument.json',
    'https://stripe.com/ucp/bank_account_instrument.json'
  ];
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€åè®®å‡çº§
- âœ… æ”¯ä»˜æä¾›å•†è‡ªä¸»å‘å¸ƒ
- âœ… åŒå‘é€‰æ‹©
- âœ… åŠ¨æ€åå•†

---

## 7. æŠ€æœ¯å®ç°

### 7.1 å®Œæ•´äº¤äº’ç¤ºä¾‹

#### æ­¥éª¤ 1: å‘ç°å•†å®¶èƒ½åŠ›

```bash
curl -X GET https://merchant.example.com/.well-known/ucp
```

**å“åº”**ï¼š

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      },
      {
        "name": "dev.ucp.shopping.discount",
        "version": "2026-01-11"
      }
    ]
  },
  "payment": {
    "handlers": [
      {
        "id": "shop_pay",
        "name": "com.shopify.shop_pay"
      },
      {
        "id": "google_pay",
        "name": "google.pay"
      }
    ]
  }
}
```

#### æ­¥éª¤ 2: åˆ›å»ºç»“è´¦ä¼šè¯

```bash
curl -X POST https://merchant.example.com/checkout-sessions \
  -H 'Content-Type: application/json' \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -d '{
    "line_items": [
      {
        "item": {
          "id": "product_123",
          "title": "çº¢ç«ç‘°èŠ±æŸ"
        },
        "quantity": 1
      }
    ],
    "buyer": {
      "full_name": "å¼ ä¸‰",
      "email": "zhang@example.com"
    },
    "currency": "USD"
  }'
```

**å“åº”**ï¼š

```json
{
  "id": "checkout_abc123",
  "line_items": [
    {
      "id": "item_1",
      "item": {
        "id": "product_123",
        "title": "çº¢ç«ç‘°èŠ±æŸ",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        { "type": "subtotal", "amount": 3500 },
        { "type": "total", "amount": 3500 }
      ]
    }
  ],
  "status": "ready_for_complete",
  "totals": [
    { "type": "subtotal", "amount": 3500 },
    { "type": "total", "amount": 3500 }
  ]
}
```

#### æ­¥éª¤ 3: åº”ç”¨æŠ˜æ‰£

```bash
curl -X PUT https://merchant.example.com/checkout-sessions/checkout_abc123 \
  -H 'Content-Type: application/json' \
  -d '{
    "id": "checkout_abc123",
    "discounts": {
      "codes": ["10OFF"]
    }
  }'
```

**å“åº”**ï¼š

```json
{
  "id": "checkout_abc123",
  "totals": [
    { "type": "subtotal", "amount": 3500 },
    { "type": "discount", "amount": 350 },
    { "type": "total", "amount": 3150 }
  ],
  "discounts": {
    "codes": ["10OFF"],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% æŠ˜æ‰£",
        "amount": 350,
        "automatic": false
      }
    ]
  }
}
```

### 7.2 Python SDK ç¤ºä¾‹

```python
from ucp import UCPClient, CheckoutRequest, LineItem

# åˆå§‹åŒ–å®¢æˆ·ç«¯
client = UCPClient(
    merchant_url="https://merchant.example.com",
    agent_profile_url="https://agent.example/profile"
)

# å‘ç°èƒ½åŠ›
capabilities = await client.discover_capabilities()
print(f"å•†å®¶æ”¯æŒ: {capabilities}")

# åˆ›å»ºç»“è´¦
checkout = await client.create_checkout(
    CheckoutRequest(
        line_items=[
            LineItem(
                item={"id": "product_123", "title": "çº¢ç«ç‘°èŠ±æŸ"},
                quantity=1
            )
        ],
        buyer={
            "full_name": "å¼ ä¸‰",
            "email": "zhang@example.com"
        },
        currency="USD"
    )
)

# åº”ç”¨æŠ˜æ‰£
checkout = await client.update_checkout(
    checkout.id,
    discounts={"codes": ["10OFF"]}
)

print(f"æœ€ç»ˆä»·æ ¼: {checkout.totals.total}")
```

### 7.3 å¤šä¼ è¾“æ”¯æŒ

UCP æ”¯æŒå¤šç§ä¼ è¾“åè®®ï¼š

#### REST API

```typescript
// REST ç»‘å®š
POST /checkout-sessions
PUT /checkout-sessions/{id}
GET /checkout-sessions/{id}
```

#### Model Context Protocol (MCP)

```typescript
// MCP å·¥å…·å®šä¹‰
{
  "tools": [
    {
      "name": "create_checkout",
      "description": "åˆ›å»ºç»“è´¦ä¼šè¯",
      "inputSchema": {
        "type": "object",
        "properties": {
          "lineItems": { "type": "array" },
          "buyer": { "type": "object" }
        }
      }
    }
  ]
}
```

#### Agent2Agent (A2A)

```typescript
// A2A æ¶ˆæ¯
{
  "type": "request",
  "action": "checkout.create",
  "params": {
    "lineItems": [...],
    "buyer": {...}
  }
}
```

---

## 8. Google é›†æˆ

### 8.1 Google å®ç°

Google æ„å»ºäº† UCP çš„é¦–ä¸ªå‚è€ƒå®ç°ï¼Œæ”¯æŒï¼š

- **AI Mode in Search**: åœ¨æœç´¢ä¸­ç›´æ¥è´­ä¹°
- **Gemini App**: å¯¹è¯å¼è´­ç‰©ä½“éªŒ
- **Google Pay**: æ— ç¼æ”¯ä»˜é›†æˆ

```mermaid
graph LR
    A[ç”¨æˆ·] -->|"æ‰¾ä¸€ä¸ªè½»ä¾¿çš„è¡Œæç®±"| B[AI Mode / Gemini]
    B -->|UCP Discovery| C[å•†å®¶]
    C -->|äº§å“ä¿¡æ¯| B
    B -->|å±•ç¤ºäº§å“| A
    A -->|"è´­ä¹°"| B
    B -->|UCP Checkout| C
    C -->|ç»“è´¦ä¼šè¯| B
    B -->|Google Pay| D[æ”¯ä»˜]
    D -->|å®Œæˆ| C
```

### 8.2 å•†å®¶é›†æˆæ­¥éª¤

#### 1. Merchant Center é…ç½®

```bash
# å‰ææ¡ä»¶
- æ‹¥æœ‰ Merchant Center è´¦æˆ·
- ä¸Šä¼ äº§å“æ•°æ®
- äº§å“ç¬¦åˆç»“è´¦è¦æ±‚
```

#### 2. UCP ç«¯ç‚¹å®ç°

```typescript
// å®ç° UCP ç«¯ç‚¹
app.get('/.well-known/ucp', (req, res) => {
  res.json({
    ucp: {
      version: '2026-01-11',
      services: {
        'dev.ucp.shopping': {
          version: '2026-01-11',
          rest: {
            endpoint: 'https://yourstore.com/ucp'
          }
        }
      },
      capabilities: [
        { name: 'dev.ucp.shopping.checkout' },
        { name: 'dev.ucp.shopping.discount' }
      ]
    },
    payment: {
      handlers: [
        {
          id: 'google_pay',
          name: 'google.pay',
          config: {
            merchantId: 'YOUR_MERCHANT_ID'
          }
        }
      ]
    }
  });
});
```

#### 3. æäº¤é›†æˆç”³è¯·

```bash
# æ­¥éª¤
1. é˜…è¯» Google é›†æˆæŒ‡å—
   https://developers.google.com/merchant/ucp

2. å®Œæˆ UCP é›†æˆ
   https://developers.google.com/merchant/ucp/guides/checkout

3. æäº¤å•†å®¶å…´è¶£è¡¨å•

4. ç­‰å¾…å®¡æ ¸
```

### 8.3 ç”¨æˆ·ä½“éªŒ

**ç¤ºä¾‹æŸ¥è¯¢**: "Find a light-weight suitcase for an upcoming trip."

```mermaid
sequenceDiagram
    participant User
    participant Google
    participant Merchant
    participant Payment
    
    User->>Google: æœç´¢è½»ä¾¿è¡Œæç®±
    Google->>Merchant: UCP Discovery
    Merchant->>Google: äº§å“åˆ—è¡¨
    Google->>User: å±•ç¤ºäº§å“
    
    User->>Google: é€‰æ‹©å¹¶è´­ä¹°
    Google->>Merchant: Create Checkout
    Merchant->>Google: Checkout Session
    
    Google->>User: æ˜¾ç¤ºç»“è´¦ç•Œé¢
    User->>Google: ç¡®è®¤ Google Pay
    Google->>Payment: å¤„ç†æ”¯ä»˜
    Payment->>Merchant: æ”¯ä»˜ç¡®è®¤
    Merchant->>Google: è®¢å•å®Œæˆ
    Google->>User: æ˜¾ç¤ºè®¢å•è¯¦æƒ…
```

---

## 9. æœ€ä½³å®è·µ

### 9.1 èƒ½åŠ›è®¾è®¡åŸåˆ™

#### 1. æœ€å°åŒ–æ ¸å¿ƒï¼Œæ‰©å±•å¢å¼º

```typescript
// âœ… å¥½çš„è®¾è®¡
interface Checkout {
  // æ ¸å¿ƒå­—æ®µ
  id: string;
  lineItems: LineItem[];
  totals: Total[];
}

interface FulfillmentExtension extends Checkout {
  // æ‰©å±•å­—æ®µ
  fulfillmentGroups?: FulfillmentGroup[];
}

// âŒ ä¸å¥½çš„è®¾è®¡
interface Checkout {
  id: string;
  lineItems: LineItem[];
  totals: Total[];
  fulfillmentGroups: FulfillmentGroup[];  // ä¸åº”åœ¨æ ¸å¿ƒ
  loyaltyPoints: number;  // ä¸åº”åœ¨æ ¸å¿ƒ
  giftWrap: GiftWrapOptions;  // ä¸åº”åœ¨æ ¸å¿ƒ
}
```

#### 2. ç‹¬ç«‹ç‰ˆæœ¬åŒ–

```json
{
  "capabilities": [
    {
      "name": "dev.ucp.shopping.checkout",
      "version": "2026-01-11"
    },
    {
      "name": "dev.ucp.shopping.fulfillment",
      "version": "2026-02-01"
    }
  ]
}
```

#### 3. å‘åå…¼å®¹

```typescript
// æ·»åŠ æ–°å­—æ®µæ—¶ä½¿ç”¨å¯é€‰
interface CheckoutV2 extends CheckoutV1 {
  // æ–°å­—æ®µå¿…é¡»å¯é€‰
  newField?: string;
}
```

### 9.2 å®‰å…¨å®è·µ

#### 1. ç­¾åéªŒè¯

```typescript
// éªŒè¯è¯·æ±‚ç­¾å
app.use((req, res, next) => {
  const signature = req.headers['request-signature'];
  const requestId = req.headers['request-id'];
  
  if (!verifySignature(req.body, signature, requestId)) {
    return res.status(401).json({ error: 'Invalid signature' });
  }
  
  next();
});
```

#### 2. å¹‚ç­‰æ€§

```typescript
// ä½¿ç”¨å¹‚ç­‰æ€§é”®
app.post('/checkout-sessions', async (req, res) => {
  const idempotencyKey = req.headers['idempotency-key'];
  
  // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
  const existing = await checkoutStore.getByIdempotencyKey(idempotencyKey);
  if (existing) {
    return res.json(existing);
  }
  
  // åˆ›å»ºæ–°ä¼šè¯
  const checkout = await createCheckout(req.body);
  await checkoutStore.saveWithIdempotencyKey(checkout, idempotencyKey);
  
  res.json(checkout);
});
```

#### 3. é€Ÿç‡é™åˆ¶

```typescript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 60 * 1000,  // 1 åˆ†é’Ÿ
  max: 100,  // æœ€å¤š 100 æ¬¡è¯·æ±‚
  message: 'Too many requests'
});

app.use('/checkout-sessions', limiter);
```

### 9.3 æ€§èƒ½ä¼˜åŒ–

#### 1. ç¼“å­˜ Profile

```typescript
// ç¼“å­˜å•†å®¶ Profile
const profileCache = new Map();

app.get('/.well-known/ucp', (req, res) => {
  const cached = profileCache.get('profile');
  if (cached && Date.now() - cached.timestamp < 3600000) {
    return res.json(cached.data);
  }
  
  const profile = generateProfile();
  profileCache.set('profile', {
    data: profile,
    timestamp: Date.now()
  });
  
  res.json(profile);
});
```

#### 2. å¼‚æ­¥å¤„ç†

```typescript
// å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
app.post('/checkout-sessions', async (req, res) => {
  // å¿«é€Ÿåˆ›å»ºä¼šè¯
  const checkout = await createCheckoutSession(req.body);
  
  // å¼‚æ­¥å¤„ç†åº“å­˜æ£€æŸ¥
  processInventoryCheck(checkout.id).catch(console.error);
  
  // ç«‹å³è¿”å›
  res.json(checkout);
});
```

### 9.4 é”™è¯¯å¤„ç†

```typescript
// æ ‡å‡†é”™è¯¯å“åº”
interface UCPError {
  error: {
    code: string;
    message: string;
    details?: any;
  };
}

// é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err, req, res, next) => {
  const ucpError: UCPError = {
    error: {
      code: err.code || 'internal_error',
      message: err.message,
      details: err.details
    }
  };
  
  res.status(err.statusCode || 500).json(ucpError);
});
```

---

## 10. æ€»ç»“

### 10.1 æ ¸å¿ƒä»·å€¼

UCP ä¸º AI é©±åŠ¨çš„ç”µå•†æä¾›äº†ï¼š

1. **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„åè®®è¯­è¨€
2. **å¯æ‰©å±•**: çµæ´»çš„èƒ½åŠ›å’Œæ‰©å±•ç³»ç»Ÿ
3. **å»ä¸­å¿ƒåŒ–**: åå‘åŸŸåå‘½åï¼Œæ— éœ€å®¡æ‰¹
4. **åä½œ**: äººæœºåä½œçš„æ— ç¼ç§»äº¤
5. **å¼€æ”¾**: å¼€æºåè®®ï¼Œç¤¾åŒºé©±åŠ¨

### 10.2 æŠ€æœ¯äº®ç‚¹

```mermaid
mindmap
  root((UCP))
    åˆ†å±‚æ¶æ„
      ä¼ è¾“å±‚
      æœåŠ¡å±‚
      èƒ½åŠ›å±‚
      æ‰©å±•å±‚
    åŠ¨æ€åå•†
      Profile å‘ç°
      èƒ½åŠ›äº¤é›†
      æ”¯ä»˜åå•†
    æ‰©å±•æœºåˆ¶
      ç»„åˆæ¨¡å¼
      ç‹¬ç«‹ç‰ˆæœ¬
      å‘½åç©ºé—´
    åä½œæ¨¡å¼
      çŠ¶æ€æœº
      Handoff
      ECP
    æ”¯ä»˜æ¶æ„
      å·¥å…·åˆ†ç¦»
      Handler æ‰©å±•
      åŒå‘é€‰æ‹©
```

### 10.3 æœªæ¥å±•æœ›

**çŸ­æœŸ**ï¼š
- æ›´å¤šå•†å®¶é›†æˆ
- æ›´å¤š AI å¹³å°æ”¯æŒ
- æ›´ä¸°å¯Œçš„æ‰©å±•ç”Ÿæ€

**ä¸­æœŸ**ï¼š
- è·¨å‚ç›´é¢†åŸŸæ‰©å±•ï¼ˆæ—…æ¸¸ã€é¤é¥®ç­‰ï¼‰
- æ›´å¤šä¼ è¾“åè®®æ”¯æŒ
- å¢å¼ºçš„å®‰å…¨ç‰¹æ€§

**é•¿æœŸ**ï¼š
- å…¨çƒç”µå•†æ ‡å‡†
- å®Œæ•´çš„ AI å•†åŠ¡ç”Ÿæ€
- å»ä¸­å¿ƒåŒ–å•†åŠ¡ç½‘ç»œ

### 10.4 å¼€å‘èµ„æº

**å®˜æ–¹èµ„æº**ï¼š
- [UCP è§„èŒƒ](https://ucp.dev)
- [Shopify æ–‡æ¡£](https://shopify.dev/docs/ucp)
- [Google é›†æˆæŒ‡å—](https://developers.google.com/merchant/ucp)
- [GitHub ä»“åº“](https://github.com/universal-commerce-protocol/ucp)

**ç¤ºä¾‹ä»£ç **ï¼š
- [Python SDK](https://github.com/Universal-Commerce-Protocol/python-sdk)
- [ç¤ºä¾‹æœåŠ¡å™¨](https://github.com/Universal-Commerce-Protocol/samples)

**ç¤¾åŒº**ï¼š
- [Discord](https://discord.gg/ucp)
- [è®ºå›](https://community.ucp.dev)

---

**ç»“è¯­**ï¼š

UCP ä»£è¡¨äº†ç”µå•†åè®®è®¾è®¡çš„æ–°èŒƒå¼ã€‚é€šè¿‡åˆ†å±‚æ¶æ„ã€åŠ¨æ€åå•†å’Œå¼€æ”¾æ‰©å±•ï¼Œå®ƒä¸º AI æ—¶ä»£çš„å•†åŠ¡äº¤äº’æä¾›äº†åšå®çš„åŸºç¡€ã€‚æ— è®ºä½ æ˜¯å•†å®¶ã€AI å¹³å°è¿˜æ˜¯æ”¯ä»˜æä¾›å•†ï¼ŒUCP éƒ½ä¸ºä½ æä¾›äº†å‚ä¸ä¸‹ä¸€ä»£ç”µå•†ç”Ÿæ€çš„æ ‡å‡†åŒ–è·¯å¾„ã€‚

è®©æˆ‘ä»¬ä¸€èµ·æ„å»º AI é©±åŠ¨çš„å•†åŠ¡æœªæ¥ï¼ğŸš€
